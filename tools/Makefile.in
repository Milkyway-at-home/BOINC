DEPTH   = ..
topsrcdir       = @top_srcdir@
srcdir          = @srcdir@
VPATH           = @srcdir@

VERSION = 1

MYSQL_INC = /usr/local/mysql/include

CFLAGS = -g -Wall @DEFS@ \
    -DHOSTTYPE=\"@host@\" \
    -DVERSION=$(VERSION) \
    -I @top_srcdir@/lib \
    -I @top_srcdir@/RSAEuro/source \
    -I @top_srcdir@/db \
    -I $(MYSQL_INC)

CC = @CC@ $(CFLAGS)

CRYPTO_LIBS = \
    ../lib/crypt.o \
    ../RSAEuro/source/rsaeuro.a

OBJS = \
    backend_lib.o \
    process_result_template.o

PROGS = create_work add country_select
all: $(PROGS) $(OBJS)

MYSQL_DIR = /usr/local/mysql/lib
MYSQL_LIBS = \
-L$(MYSQL_DIR) -L/usr/local/lib/mysql \
-L/sw/lib/mysql -lmysqlclient -L/usr/local/lib -lz \
-lm $(NETLIBS)

NETLIBS = -lsocket -lnsl

LIBS = \
    backend_lib.o \
    process_result_template.o \
    ../lib/md5_file.o \
    ../lib/md5.o \
    ../lib/parse.o \
    ../db/db_mysql.o \
    ../db/mysql_util.o

.C.o:
	$(CC) -c -o $*.o $<

create_work: create_work.o $(LIBS) $(CRYPTO_LIBS)
	$(CC) create_work.o $(CRYPTO_LIBS) $(LIBS) $(MYSQL_LIBS) -o create_work

add: add.o $(LIBS) $(CRYPTO_LIBS)
	$(CC) add.o $(LIBS) $(CRYPTO_LIBS) $(MYSQL_LIBS) -o add

country_select: country_select.o ../lib/countries.o
	$(CC) country_select.o ../lib/countries.o -o country_select

clean:
	rm -f *.o create_work add core country_select dependencies

install:
	-mkdir -p /usr/local/boinc/tools
	cp create_work /usr/local/boinc/tools/create_work
	cp add /usr/local/boinc/tools/add
	cp country_select /usr/local/boinc/tools/country_select

dependencies: @srcdir@/*.C
	$(CC) -M @srcdir@/*.C > dependencies

include dependencies

