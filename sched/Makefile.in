DEPTH   = ..
topsrcdir       = @top_srcdir@
srcdir          = @srcdir@
VPATH           = @srcdir@

all: cgi

CFLAGS = -g -Wall -I @top_srcdir@/db -I @top_srcdir@/lib -I @top_srcdir@/tools
CC = g++ $(CFLAGS)

CLIBS = @LIBS@

PROGS = cgi feeder

all: $(PROGS)

CGI_OBJS = \
    handle_request.o \
    main.o \
    parse.o \
    sched_shmem.o \
    server_types.o \
    ../db/db_mysql.o \
    ../db/mysql_util.o \
    ../lib/shmem.o \
    ../tools/process_result_template.o

FEEDER_OBJS = \
    feeder.o \
    sched_shmem.o \
    ../db/db_mysql.o \
    ../db/mysql_util.o \
    ../lib/shmem.o

MYSQL_DIR = /usr/local/mysql/lib
MYSQL_LIBS = \
-L$(MYSQL_DIR) \
-lmysqlclient -lz \
-lm $(NETLIBS)

.C.o:
	$(CC) -c -o $*.o $<
.c.o:
	$(CC) -c -o $*.o $<

cgi: $(CGI_OBJS)
	$(CC) $(CGI_OBJS) $(MYSQL_LIBS) $(CLIBS) -o cgi

feeder: $(FEEDER_OBJS)
	$(CC) $(FEEDER_OBJS) $(MYSQL_LIBS) $(CLIBS) -o feeder

dependencies: @srcdir@/*.C
        $(CC) -M @srcdir@/*.C > dependencies

include dependencies

clean:
	rm -f $(PROGS) *.o core dependencies config.cache
